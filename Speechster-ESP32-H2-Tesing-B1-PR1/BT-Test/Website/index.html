<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Speechster-H2 BLE Dashboard</title>
<style>
body { font-family: sans-serif; padding: 20px; }
#logs { border: 1px solid #ccc; height: 200px; overflow-y: scroll; padding: 5px; }
</style>
</head>
<body>
<h1>BLE Device Selector</h1>

<select id="deviceSelect"></select>
<button id="connectBtn">Connect</button>

<h2>Send Data</h2>
<input id="dataInput" placeholder='Raw or JSON'>
<button id="sendBtn">Send</button>

<h2>Logs</h2>
<div id="logs"></div>

<script>
const ws = new WebSocket('ws://localhost:8080');
const deviceSelect = document.getElementById('deviceSelect');
const connectBtn = document.getElementById('connectBtn');
const sendBtn = document.getElementById('sendBtn');
const dataInput = document.getElementById('dataInput');
const logs = document.getElementById('logs');

ws.onopen = () => log('WebSocket connected');
ws.onmessage = event => {
  const msg = JSON.parse(event.data);
  if (msg.type === 'deviceList') {
    deviceSelect.innerHTML = '';
    msg.devices.forEach(d => {
      const opt = document.createElement('option');
      opt.value = d.id;
      opt.text = `${d.name} (${d.address})`;
      deviceSelect.appendChild(opt);
    });
  } else if (msg.type === 'services') {
    log('Services: ' + JSON.stringify(msg.services, null, 2));
  } else if (msg.type === 'notification') {
    log('Notification: ' + msg.payload);
  } else if (msg.type === 'disconnected') {
    log('Device disconnected');
  }
};

connectBtn.onclick = () => {
  const id = deviceSelect.value;
  if (id) ws.send(JSON.stringify({ type: 'connect', deviceId: id }));
};

sendBtn.onclick = () => {
  const val = dataInput.value;
  if (val) {
    try {
      ws.send(JSON.stringify({ type: 'send', payload: JSON.parse(val) }));
    } catch {
      ws.send(JSON.stringify({ type: 'send', payload: val }));
    }
  }
};

function log(msg) {
  const div = document.createElement('div');
  div.textContent = msg;
  logs.appendChild(div);
  logs.scrollTop = logs.scrollHeight;
}
</script>
</body>
</html>
